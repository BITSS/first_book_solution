--- 
title: "First Book Using DD"
author: "Your Name"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
biblio-style: apalike
link-citations: yes
always_allow_html: true
github-repo: BITSS/first_book_solution
description: "This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook."
output:
  bookdown::html_document2: default
  bookdown::word_document2:
    toc: true
  keep_tex:  true
    
---

```{r global pars, eval=TRUE, echo=FALSE, results='hide'}
n.pers = 21
n.sims = 1e4
set.seed(1234)
```  







<!--chapter:end:index.Rmd-->

# Hands-on excercise: the birthday problem!

As an illustration lets write a report using the participants in this workshop to illustrate the famous [birthday problem](https://en.wikipedia.org/wiki/Birthday_problem). 

>What is the probability that at least two people this room share the same birthday?

>There are `r n.pers` in this room. 

>Is it something like $\frac{`r n.pers`}{365} =$   `r round(n.pers/365 , 3)`?


<!--chapter:end:01-intro.Rmd-->

# The birthday problem: the math

Actually the math says otherwise. Define p(n) as the probability that at least one pair has the same birthday, then the $1 - p(n)$ is the probability that all are born in a different day. Which we can compute as: 

--

\begin{align} 
 1 -  p(n) &= 1 \times \left(1-\frac{1}{365}\right) \times \left(1-\frac{2}{365}\right) \times \cdots \times \left(1-\frac{n-1}{365}\right) \nonumber  \newline
 &= \frac{ 365 \times 364 \times \cdots \times (365-n+1) }{ 365^n } \nonumber \newline
 &= \frac{ 365! }{ 365^n (365-n)!} = \frac{n!\cdot\binom{365}{n}}{365^n}\newline
p(n= `r n.pers`) &= `r  round(1 - factorial(n.pers) * choose(365,n.pers)/ 365^n.pers, 3)`  \nonumber
\end{align}

## Code for the math 

(`/dynamicdocs/first_dd_solution.Rmd`)

Copy and paste lines below into your `first_dd.Rmd`

```{latex, eval=FALSE}
\begin{align} 
 1 -  p(n) &= 1 \times \left(1-\frac{1}{365}\right) \times
              \left(1-\frac{2}{365}\right) \times \cdots \times
              \left(1-\frac{n-1}{365}\right) \nonumber  \newline
           &= \frac{365 \times 364 \times \cdots \times (365-n+1) }{365^n} \nonumber \newline
           &= \frac{ 365! }{ 365^n (365-n)!} = \frac{n!\cdot\binom{365}{n}}{365^n}\newline
\p(n= `r n.pers`) &= `r  round(1 - factorial(n.pers) * 
                          choose(365,n.pers)/ 365^n.pers, 3)`  \nonumber
\end{align}
```



<!--chapter:end:02-math.Rmd-->

# Don't like math? Let's run a simple simulation!   


 1 - Simulate `r n.sims` rooms with $n = `r n.pers`$ random birthdays, and store the results in matrix where each row represents a room.   
 
 2 - For each room (row) compute the number of unique birthdays.   
 
 3 - Compute the average number of times a room has `r n.pers` unique birthdays, across `r n.sims` simulations, and report the complement.    




## Code for the simulation 

(`/dynamicdocs/first_dd_solution.Rmd`)  


```{r birthday prob, eval=TRUE, echo=TRUE}
birthday.prob = function(n.pers_var, n.sims_var) {
  # simulate birthdays
  birthdays = matrix(round(runif(n = n.pers_var * n.sims_var, min = 1, max = 365) ),
                     nrow = n.sims_var, ncol = n.pers_var)
  # for each room (row) get unique birthdays
  unique.birthdays = apply(birthdays, 1,
                           function(x)  length( unique(x) ) )
  # Indicator with 1 if all are unique birthdays
  all.different = 1 * (unique.birthdays==n.pers_var)
  # Compute average time all have different birthdays 
  result = 1 - mean(all.different)
return(result)
}

bp_sim = birthday.prob(n.pers_var = 21, n.sims_var = 10000)
print(bp_sim)
```


<!--chapter:end:03-sims.Rmd-->

# Results   


- Many people originally think of a prob ~ $\frac{1}{365} \times n =   `r round(1/365 * n.pers, 3)`$

- However the true probability is of $p(n= `r n.pers`) = `r round(1 - factorial(n.pers) * choose(365,n.pers)/ 365^n.pers, 3)`$

- And the simulated probability is of  $`r bp_sim`$
]

<!--
asd <- sapply(1:365, function(x) round(1 - factorial(x) * 
+           choose(365,x)/ 365^x, 3) )

plot(1:100, asd[1:100], type = "l")


> asd1 <- function(y) sapply(1:100, function(x) birthday.prob(n.pers_var = x, y) )


> lines(asd1(5), col="red")
> lines(asd1(30), col="blue")
> lines(asd1(100), col="green")
> points(asd1(1000), pch=3)
legend(60, 0.3, legend=c("5 sims", "30 sims", "100 sims", "1000 sims"),
+        col=c("red", "blue", "green", "black"), lty=c(1,1,1,3), cex=0.8)

title(main="main title", sub="sub-title", 
   xlab="x-axis label", ylab="y-axis label")

-->

<!--chapter:end:04-results.Rmd-->

`r if (knitr::is_html_output()) '
# References {-}
'`

<!--chapter:end:05-references.Rmd-->

